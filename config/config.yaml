# Configuration for Travel Search Ranking System

# Paths
paths:
  raw_data: "data/raw"
  processed_data: "data/processed"
  queries: "data/queries"
  models: "models"
  results: "results"

# Random Seeds (for reproducibility)
random_seed: 42

# Query Intent Model
query_intent:
  model_name: "sentence-transformers/all-MiniLM-L6-v2"
  intent_classes:
    - budget
    - luxury
    - family
    - business
    - airport
    - downtown
    - beach
    - romantic
  max_length: 64
  batch_size: 32
  learning_rate: 2e-5
  epochs: 3
  validation_split: 0.2

# Feature Engineering
features:
  # Structured features
  structured:
    - hotel_price
    - hotel_rating
    - distance_km
    - num_reviews
    - cancellation_flexibility
    - amenities_count
    - room_types_count
    
  # NLP features
  nlp:
    - query_hotel_similarity
    - intent_match_score
    - keyword_overlap
    - semantic_embedding
    
  # Contextual features
  contextual:
    - device_type
    - party_size
    - length_of_stay
    - booking_window_days
    - is_weekend
    - season

# Learning-to-Rank Model
ltr:
  model_type: "xgboost"  # or "lightgbm"
  
  xgboost_params:
    objective: "rank:pairwise"
    eval_metric: "ndcg@10"
    eta: 0.1
    max_depth: 6
    min_child_weight: 1
    subsample: 0.8
    colsample_bytree: 0.8
    num_boost_round: 100
    early_stopping_rounds: 10
    
  lightgbm_params:
    objective: "lambdarank"
    metric: "ndcg"
    ndcg_eval_at: [5, 10, 20]
    learning_rate: 0.1
    num_leaves: 31
    max_depth: 6
    feature_fraction: 0.8
    bagging_fraction: 0.8
    bagging_freq: 5
    num_iterations: 100
    early_stopping_round: 10
    
  train_split: 0.8
  cv_folds: 5

# Meta-Model (Multi-Objective Optimizer)
meta_model:
  objectives:
    - relevance  # P(click) or P(book)
    - quality    # hotel_rating
    - price      # -price_competitiveness
    - risk       # -risk_score
    
  segment_features:
    - intent_budget
    - intent_luxury
    - intent_family
    - intent_business
    - party_size
    - length_of_stay
    - price_sensitivity
    - quality_sensitivity
    - avg_distance
    - is_weekend
    - booking_window
    - device_mobile
    
  architecture:
    hidden_layers: [64, 32]
    activation: "relu"
    dropout: 0.2
    
  training:
    learning_rate: 0.001
    batch_size: 128
    epochs: 50
    validation_split: 0.2
    early_stopping_patience: 5
    
  optimization_metric: "conversion_rate"  # or "revenue_per_search"

# Risk/Fraud Model
risk_model:
  model_type: "lightgbm"
  
  features:
    - transaction_amount
    - booking_window_days
    - cancellation_history
    - num_previous_bookings
    - device_trust_score
    - location_risk_score
    - payment_method_risk
    - velocity_flags
    
  lightgbm_params:
    objective: "binary"
    metric: "auc"
    learning_rate: 0.05
    num_leaves: 31
    max_depth: 7
    feature_fraction: 0.8
    bagging_fraction: 0.8
    bagging_freq: 5
    num_iterations: 200
    early_stopping_round: 20
    
  threshold: 0.15  # For top-3 positions
  position_constraint: 3  # Don't show high-risk in top-3

# Synthetic Data Generation
synthetic:
  num_queries: 10000
  num_hotels: 5000
  avg_candidates_per_query: 100
  
  # Behavior model for synthetic labels
  click_model:
    base_rate: 0.15
    price_sensitivity: -0.3
    rating_boost: 0.4
    intent_match_boost: 0.5
    distance_penalty: -0.2
    noise_std: 0.1
    
  book_model:
    base_rate: 0.20  # P(book | click)
    cancellation_boost: 0.3
    amenities_boost: 0.2
    reviews_boost: 0.15
    noise_std: 0.15

# Evaluation Metrics
evaluation:
  ranking_metrics:
    - ndcg@5
    - ndcg@10
    - ndcg@20
    - map@10
    - mrr
    - recall@10
    
  business_metrics:
    - click_through_rate
    - booking_conversion_rate
    - revenue_per_search
    - average_order_value
    - risk_exposure_rate
    
  ab_test:
    confidence_level: 0.95
    power: 0.90
    min_detectable_effect: 0.02  # 2% relative lift
    sample_size_per_variant: 25000

# Production Settings (for discussion)
production:
  serving:
    max_latency_ms: 100
    cache_ttl_seconds: 300
    batch_size: 32
    
  monitoring:
    metrics_to_track:
      - p50_latency
      - p99_latency
      - ndcg@10
      - ctr
      - cvr
      - risk_exposure
      
    alert_thresholds:
      ndcg_drop: 0.05  # 5% drop triggers alert
      latency_p99_ms: 150
      risk_exposure_pct: 5.0
